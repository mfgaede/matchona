---
layout: default
---
<div class="container my-4">
    <div class="row">
        <!-- Secondary menu -->
        <div class="col-md-3">
            <nav class="secondary-menu">
                <h4><div class="lang-content english">About</div><div class="lang-content chichewa">Zokhuzana</div></h4>
                <ul class="nav flex-column" id="section-nav">
                    {% for item in site.data.secondary_menu %}
                    <li class="nav-item">
                        <a class="nav-link {% if page.url == item.url %}active{% endif %}" href="{{ item.url }}"><div class="lang-content english">{{ item.title }}</div><div class="lang-content chichewa">{{ item.title_chichewa | default: item.title }}</div></a>
                    </li>
                    {% endfor %}
                </ul>
            </nav>
        </div>
        <!-- Main content -->
        <div class="col-md-9" id="content">
            {% assign current_menu_item = site.data.secondary_menu | where: "url", page.permalink | first %}
            {% if current_menu_item %}
            <div class="lang-content english"><h1 class="page-title mb-4">{{ current_menu_item.title }}</h1></div><div class="lang-content chichewa"><h1 class="page-title mb-4">{{ current_menu_item.title_chichewa | default: current_menu_item.title }}</h1></div>
            {% else %}
            <h1 class="page-title mb-4">{{ page.title }}</h1>
            {% endif %}
            {{ content }}
        </div>
    </div>
</div>

<script>
function buildTableOfContents() {
    // Select headers but exclude those with class 'exclude-from-nav'
    const headers = document.querySelectorAll('#content h2:not(.exclude-from-nav), #content h3:not(.exclude-from-nav)');
    const sectionNav = document.querySelector('#section-nav');
    const activeNavItem = sectionNav.querySelector('.nav-link.active');

    if (headers.length > 0 && activeNavItem) {
        // Find the parent li of the active link
        const activeListItem = activeNavItem.closest('li');

        // Remove existing page sections if any
        const existingPageSections = activeListItem.querySelector('.page-sections');
        if (existingPageSections) {
            existingPageSections.remove();
        }

        // Create a container for page section links
        const pageSectionsUl = document.createElement('ul');
        pageSectionsUl.className = 'nav flex-column ms-3 mt-1 page-sections';

        // Add headers to the section list
        headers.forEach(function(header) {
            // Skip headers that are inside hidden lang-content divs
            const parentLangContent = header.closest('.lang-content');
            if (parentLangContent) {
                const isChichewaMode = document.documentElement.classList.contains('lang-ny');
                const isEnglishHeader = parentLangContent.classList.contains('english');
                const isChichewaHeader = parentLangContent.classList.contains('chichewa');

                // Skip if this header's language doesn't match the current mode
                if ((isEnglishHeader && isChichewaMode) || (isChichewaHeader && !isChichewaMode)) {
                    return;
                }
            }

            // Get visible text only (handle multilingual content)
            let headerText = header.textContent;
            const englishContent = header.querySelector('.lang-content.english');
            const chichewaContent = header.querySelector('.lang-content.chichewa');

            if (englishContent && chichewaContent) {
                // Check if Chichewa mode is active
                const isChichewaMode = document.documentElement.classList.contains('lang-ny');
                headerText = isChichewaMode ? chichewaContent.textContent : englishContent.textContent;
            }

            // Create an id if the header doesn't have one
            if (!header.id) {
                header.id = headerText.toLowerCase().replace(/[^\w]+/g, '-');
            }

            // Create list item
            const li = document.createElement('li');
            li.className = 'nav-item';

            // Add additional indentation for h3
            const indent = header.tagName === 'H3' ? 'ms-2' : '';

            // Create link
            const a = document.createElement('a');
            a.className = `nav-link ${indent} small py-1`;
            a.href = '#' + header.id;
            a.textContent = headerText;

            li.appendChild(a);
            pageSectionsUl.appendChild(li);
        });

        // Insert the sections list after the active navigation item
        activeListItem.appendChild(pageSectionsUl);
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Build initial TOC
    buildTableOfContents();

    // Listen for language changes and rebuild TOC
    // The language toggle should trigger a custom event or we can observe the html class changes
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                buildTableOfContents();
            }
        });
    });

    // Observe changes to the html element's class attribute
    observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
    });
});
</script>